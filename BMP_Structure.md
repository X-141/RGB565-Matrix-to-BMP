# Overview
The overall structure of the BMP file generated by this repository is quite simple. However, the journey to understanding what actually goes into a BMP file (Hexadecimal reading and all) is a bit ambigious. So! Hopefully, this piece of documentation kinda helps you (and me especially) understand how to build a simple BMP file.

## BMP FILE HEADER
The BMP file header defines some general information about the bitmap. As you can see in the table below, a lot of the information we write in the header makes sense. We need to tell the image processor how to read the data!

The total length of the File Header is 14 bytes.
| Field | Length (bytes) | Notes |
| -- | -- | -- |
| file type | 2 unsigned bytes | Always going to be ***0x4D42*** |
| file size | 4 unsigned bytes | Length of the file itself (BMP FILE HEADER + BMP INFO HEADER + BMP COLOR HEADER + LENGTH OF IMAGE) <sub>1</sub> |
| reserved 1 | 2 unsigned bytes | Unused. Zero'd typically |
| reserved 2 | 2 unsigned bytes | Unused. Zero'd typically |
| offset data | 4 unsigned bytes | Starting point of the actual image data we want the processor to display. In this repo, its always set to ***0x0000008A*** <sub>2</sub>

 1. Generally speaking the equation is always going to be the following: (14 + 40 + 84 + (length * width * channel)).
 2. If you've read the documentation a couple times, you've likely noticed ***0x0000008A*** is just (14 + 40 + 84) in hexadecimal!

## BMP INFO HEADER
The BMP info header contains a variety of information. Some are easier to understand than others. But! this is a living piece of documentation so information can be added/amended.

The total length of the Info Header is 40 bytes.
| Field | Length (bytes) | Notes |
| -- | -- | -- |
| Header Size | 4 unsigned bytes | Length of the header. Set as ***0x00000028*** (40 in decimal) |
| Width | 4 signed bytes | Width of the image we are storing |
| Height | 4 signed bytes | Height of the image we are storing |
| Planes | 2 unsigned bytes | Number of color planes. Set as ***0x0001*** |
| Bit Count | 2 unsigned bytes | Number of bits per pixel. Set as ***0x0010*** (16 bits per pixel) |
| Compression | 4 unsigned bytes | Compression method used. Not used in this repo. Set as ***0x00000000***
| Image Size | 4 unsigned bytes | Size of the raw image. (length * width * channel) |
| X Pixels Per Meter | 4 unsigned bytes | Pixels per meter. Set as ***0x00000000*** |
| Y Pixels Per Meter | 4 unsigned bytes | Pixels per meter. Set as ***0x00000000*** |
| Color Used | 4 unsigned bytes | Number of colors in the palette. Set as ***0x00000000***
| Important Colors | 4 unsigned bytes | Number of important colors. Set as ***0x00000000***|

## BMP COLOR HEADER
The color header essentially tells the image processor how to read each pixel stored in the bitmap. This is essential (especially given the specific RBG565 format) in order for our image to look correct!

Because we are using the RGB565 format, that means each pixel needs to be 16 bits in length. And for each of those pixels, three distinct bit subset represent a color. How those color values are stored follows the masking values below.

The total length of the Color Header is 84 bytes.
| Field | Length (bytes) | Notes |
| -- | -- | -- |
| Red Mask | 4 unsigned bytes | Which set of bits represent the color red. Set as ***0x000000F8*** <sub>1</sub>
| Green Mask | 4 unsigned bytes | Which set of bits represent the color green. Set as ***0x0000E007*** <sub>2</sub>
| Blue Mask | 4 unsigned bytes | Which set of bits represent the color blue. Set as ***0x00001F00*** <sub>3</sub>
| Alpha Mask | 4 unsigned bytes | Which set of bits represent transparenct. Not used. Set as ***0x00000000***
| Unused | 68 unsigned bytes | Unused space in the color header. All set to ***0x00***.

 1. The first 5 bits represent the color red:           1111100000000000
 2. The subsequent 6 bits represent the color green:    0000011111100000
 3. The last 5 bits represent the color blue:           0000000000011111

## STORING PIXELS
Alright, time for a bit of mind bending bit conjigguring. Keep in mind we have the following masking requirement:
 1. Red: 1111100000000000
 2. Green: 0000011111100000
 3. Blue: 0000000000011111

This is extremely important as having a slight misunderstanding will produce a inaccurate image. Rather than spew a whole bunch of rules, instructions, and nuances at you... lets do things by example!

In this repo, we allow the user to write out a RGB565 pixel value into a matrix structure. To make this easier for ourselves, lets say that the user wrote a RGB565 value of 0xFFFF. When stored in the matrix, we do some masking to ensure that the 0xFFFF is converted correctly. Here's a table to help visualize the masking. Ill be using binary as its easier to see.

Our input value:
| Input (Hex) | Input (Binary |
| -- | -- |
| 0xFFFF | 1111111111111111 |

Red pixel value in Matrix (unsigned byte)
| Input | Shifting | Shifting Result | Masking | Masking Result | Value |
| -- | -- | -- | -- | -- | -- |
| 1111111111111111 | (INPUT >> 11) | 0000000000011111 | (INPUT & 0000000000011111) | 0000000000011111 | 0000000000011111

Green pixel value in Matrix (unsigned byte)
| Input | Shifting | Shifting Result | Masking | Masking Result | Value |
| -- | -- | -- | -- | -- | -- |
| 1111111111111111 | (INPUT >> 5) | 0000011111111111 | (INPUT & 0000000000111111) | 0000000000111111 | 0000000000111111


Blue pixel value in Matrix (unsigned byte)
| Input | Shifting | Shifting Result | Masking | Masking Result | Value |
| -- | -- | -- | -- | -- | -- |
| 1111111111111111 | INPUT | 1111111111111111 | (INPUT & 0000000000011111) | 0000000000011111 | 0000000000011111

The result is that we now have a pixel in the matrix that represents the three colors in the correct RGB565 requirement. Red and blue can only have at most 5 bits, and green can have at most 6 bits.

Now that we have our pixel data, we can go ahead and begin writing them to a file to generate a BMP. To do that we first write out our header data in this order: File Header, Info Header, and Color Table.

Now that we have written out some preliminary data, we can start writing out 

### Citations
Always gotta cite your sources!
 * https://en.wikipedia.org/wiki/BMP_file_format
 * https://cdn.hackaday.io/files/274271173436768/Simplified%20Windows%20BMP%20Bitmap%20File%20Format%20Specification.htm